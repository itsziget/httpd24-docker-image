# README

## Supported tags

* latest [Dockerfile](https://github.com/itsziget/httpd24-docker-image/blob/master/Dockerfile) (Currently, it is not always the stable version. Use a version tag in production)
* 1.1.1, 1.1, 1 and 1.1.0 [Dockerfile](https://github.com/itsziget/httpd24-docker-image/blob/v1.1.1/Dockerfile)
* 1.0.0, 1.0 [Dockerfile](https://github.com/itsziget/httpd24-docker-image/blob/v1.0.0/Dockerfile)

**Note**: Version 1.1.0 was rebuilt based on the changed official httpd:2.4 image which made the itsziget/httpd24:1.1.0 unusable without loading any MPM module. Just to make sure nobody will download a broken version 1.1.0 is built from 1.1.1 now.

## Description

You may want to use this HTTPD 2.4 if you 
 
- need to quickly run a webserver with PHP-FPM
- easily turn SSL on/off
- easily turn HTTP Basic authentication on/off
- use a reverse proxy without changing the client IP
- reconfigure the following directives without a custom configuration file:
  - DocumentRoot
  - ServerName
  - ServerAdmin
  
Set the the following environment variables as you need:

- **SRV_NAME**: (default: localhost.localdomain) This will change the default ServerName
- **SRV_ADMIN**: (default: webmaster@localhost) This variable is for ServerAdmin
- **SRV_DOCROOT**: (default: /usr/local/apache2/htdocs) DocumentRoot can be configured by setting this variable.
- **SRV_REVERSE_PROXY_DOMAIN**: (default: "") It can contain the IP address or hostname of the reverse proxy server. It is important if you want to see the real IP addresses of clients when you use a reverse proxy.
- **SRV_REVERSE_PROXY_CLIENT_IP_HEADER**: (default: X-Forwarded-For) The name of the header which contains the real IP address. It is ignored when SRV_REVERSE_PROXY_DOMAIN is not given.
- **SRV_SSL**: (default: 0) Set this variable to 1 if you want HTTPD to listen on port 443 and use SSL certificates. In this case you have to mount your private key file and the certificate (full chain) to the container. See variable SSL_CERT and SSL_CERT_KEY.
- **SRV_CERT**: Since v1.1.0. (default: /usr/local/apache2/ssl.crt) SSL certificate file 
- **SRV_CERT_KEY**: Since v1.1.0 (default: /usr/local/apache2/ssl.key) SSL key file
- **SRV_LETSENCRYPT**: Since v1.1.0. (default: 0) Set this to 1 if you want to load certificates generated by Let's Encrypt. It will set SRV_CERT (/etc/letsencrypt/live/**$CERT_NAME**/fullchain.pem) and SRV_CERT_KEY (/etc/letsencrypt/live/**$CERT_NAME**/pivkey.pem) if they are not set yet. To be compatible with [jwilder/docker-gen](https://hub.docker.com/r/jwilder/docker-gen/) the value of $CERT_NAME could come from multiple variables in the following order: CERT_NAME, SRV_NAME, VIRTUAL_HOST
- **CERT_NAME**: See SRV_LETSENCRYPT
- **VIRTUAL_HOST**: See SRV_LETSENCRYPT
- **SRV_AUTH**: (default: 0) Set this to 1 if you need HTTP Basic authentication using an htpasswd file. Mount password file inside the container at /usr/local/apache2/.htpasswd \
- **SRV_PHP**: (default: 0) If you need PHP-FPM, set it to 1. In this case HTTPD will use "php" as hostname to connect to the FPM service on port 9000. You can customize using following variables \
  - **SRV_PHP_HOST**: (default: php) The hostname of the PHP-FPM service.
  - **SRV_PHP_PORT**: (default: 9000) The port number of the PHP-FPM service.
  
## Examples

### Using SSL certificate

**With Let's Encrypt without custom certificate name:**
```bash
docker run -d \
   --env SRV_SSL=1 \
   --env SRV_LETSENCRYPT=1 \
   --env SRV_NAME=YOURDOMAIN \
   -v /etc/letsencrypt:/etc/letsencrypt \
   -p 443:443 \
   itsziget/httpd24
```

**With Let's Encrypt and custom certificate name:**

```bash
docker run -d \
   --env SRV_SSL=1 \
   --env SRV_LETSENCRYPT=1 \
   --env SRV_NAME=YOURDOMAIN \
   --env CERT_NAME=CUSTOMCERTNAME \
   -v /etc/letsencrypt:/etc/letsencrypt \
   -p 443:443 \
   itsziget/httpd24
```

**You can mount custom certificate two ways:**

```bash
docker run -d \
   --env SRV_SSL=1 \
   -v /path/to/custom.key:/usr/local/apache2/ssl.key \
   -v /path/to/custom.crt:/usr/local/apache2/ssl.crt \
   -p 443:443 \
   itsziget/httpd24
```
or
```bash
docker run -d \
   --env SRV_SSL=1 \
   --env SRV_CERT=/ssl.crt \
   --env SRV_CERT_KEY=/ssl.key \
   -v /path/to/custom.key:/ssl.key \
   -v /path/to/custom.crt:/ssl.crt \
   -p 443:443 \
   itsziget/httpd24
```

### HTTP Authentication

```bash
docker run --rm -i itsziget/httpd24 /bin/bash -c "htpasswd -nb YOURUSERNAME YOURPASSWORD" >> .htpasswd
docker run -d \
   -v `pwd`/.htpasswd:/usr/local/apache2/.htpasswd \
   -p 80:80 \
   itsziget/httpd24
```

### Simplest way to use PHP-FPM

**Legacy way:**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   -p "80:80" \
   --link php \
   itsziget/httpd24
   
```

**Recommended way:**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker network create phptest
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   --network phptest \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   -p "80:80" \
   --network phptest \
   itsziget/httpd24
   
```

**Reusing the network of the HTTPD container**

```bash
mkdir -p src
echo "<?php phpinfo(); " > src/index.php
docker run -d \
   -v $PWD/src:/usr/local/apache2/htdocs \
   --name php \
   -p "80:80" \
   php:7.1-fpm
docker run -d \
   --volumes-from php \
   --env SRV_PHP=1 \
   --env SRV_PHP_HOST=localhost \
   --network container:php \
   itsziget/httpd24
   
```

**Tip:** If you need PHP with more modules than the official version built with, use my version: [https://hub.docker.com/r/itsziget/php/](https://hub.docker.com/r/itsziget/php/)